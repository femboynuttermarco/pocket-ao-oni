<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pet Game</title>
  <style>
    body {
      margin: 0;
      padding: 10px;
      font-family: Arial, sans-serif;
      user-select: none;
      height: 100vh;
      overflow: hidden;
    }

    #top-bar {
      position: fixed;
      top: 10px;
      right: 10px;
      background: rgba(255, 255, 255, 0.95);
      padding: 10px;
      border-radius: 10px;
      width: 200px;
      box-shadow: 0 0 6px rgba(0, 0, 0, 0.1);
    }

    .stat {
      margin-bottom: 10px;
    }

    .stat-label {
      font-weight: bold;
    }

    .stat-bar-bg {
      background: #ccc;
      height: 14px;
      border-radius: 7px;
      margin-top: 4px;
      overflow: hidden;
    }

    .stat-bar {
      height: 14px;
      border-radius: 7px;
      width: 100%;
      background: green;
      transition: width 0.3s, background-color 0.3s;
    }

    #buttons {
      position: fixed;
      top: 10px;
      left: 10px;
      display: flex;
      gap: 10px;
    }

    #buttons button {
      padding: 8px 14px;
      font-size: 14px;
      cursor: pointer;
    }

    #room {
      margin-top: 60px;
      text-align: center;
    }

    #pet-canvas {
      width: 400px;
      height: 400px;
      border: 1px solid #aaa;
      border-radius: 10px;
      display: block;
      margin: 0 auto;
      cursor: crosshair;
    }

    #shower-items, #kitchen-items {
      display: none;
      margin-top: 10px;
      justify-content: center;
      gap: 30px;
      font-size: 40px;
    }

    .drag-item, .kitchen-item {
      cursor: grab;
      user-select: none;
    }

    .dragging {
      opacity: 0.5;
    }
  </style>
</head>
<body>

  <div id="top-bar">
    <div class="stat">
      <div class="stat-label">Hunger</div>
      <div class="stat-bar-bg"><div id="hunger-bar" class="stat-bar"></div></div>
    </div>
    <div class="stat">
      <div class="stat-label">Health</div>
      <div class="stat-bar-bg"><div id="health-bar" class="stat-bar"></div></div>
    </div>
    <div class="stat">
      <div class="stat-label">Fun</div>
      <div class="stat-bar-bg"><div id="fun-bar" class="stat-bar"></div></div>
    </div>
  </div>

  <div id="buttons">
    <button onclick="showRoom('shower')">Shower</button>
    <button onclick="showRoom('kitchen')">Kitchen</button>
    <button onclick="alert('Games coming soon!')">Games</button>
  </div>

  <div id="room">
    <canvas id="pet-canvas" width="400" height="400"></canvas>

    <div id="shower-items">
      <div id="soap" class="drag-item" draggable="true" title="Soap">ðŸ§¼</div>
      <div id="shower" class="drag-item" draggable="true" title="Shower">ðŸš¿</div>
    </div>

    <div id="kitchen-items"></div>
  </div>

  <script>
    const stats = { hunger: 100, health: 100, fun: 100 };
    function updateBars() {
      ['hunger', 'health', 'fun'].forEach(stat => {
        const bar = document.getElementById(`${stat}-bar`);
        bar.style.width = `${stats[stat]}%`;
        bar.style.backgroundColor = stats[stat] > 60 ? 'green' : stats[stat] > 30 ? 'orange' : 'red';
      });
    }
    updateBars();

    const canvas = document.getElementById('pet-canvas');
    const ctx = canvas.getContext('2d');
    let originalImageData, currentImageData;

    const petImage = new Image();
    petImage.crossOrigin = "anonymous";
    petImage.src = "https://tse2.mm.bing.net/th/id/OIP.LuohQanTX6FMimfo2B000wAAAA?rs=1&pid=ImgDetMain&o=7&rm=3";
    petImage.onload = () => {
      ctx.drawImage(petImage, 0, 0, canvas.width, canvas.height);
      originalImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      currentImageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    };

    function showRoom(room) {
      document.getElementById('shower-items').style.display = 'none';
      document.getElementById('kitchen-items').style.display = 'none';
      if (room === 'shower') {
        document.getElementById('shower-items').style.display = 'flex';
      } else if (room === 'kitchen') {
        document.getElementById('kitchen-items').style.display = 'flex';
        generateKitchenItems();
      }
    }

    let draggingItem = null;

    document.querySelectorAll('.drag-item').forEach(item => {
      item.addEventListener('dragstart', () => {
        draggingItem = item.id;
        item.classList.add('dragging');
      });
      item.addEventListener('dragend', () => {
        draggingItem = null;
        item.classList.remove('dragging');
      });
    });

    canvas.addEventListener('dragover', e => {
      e.preventDefault();
      if (!draggingItem) return;
      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;
      if (draggingItem === 'soap') paintSoap(x, y);
      else if (draggingItem === 'shower') paintShower(x, y);
    });

    function getIndex(x, y, w) {
      return (Math.floor(y) * w + Math.floor(x)) * 4;
    }

    function paintSoap(cx, cy) {
      if (!currentImageData) return;
      const r = 15;
      const data = currentImageData.data;
      for (let y = Math.max(0, cy - r); y < Math.min(canvas.height, cy + r); y++) {
        for (let x = Math.max(0, cx - r); x < Math.min(canvas.width, cx + r); x++) {
          const dx = x - cx, dy = y - cy;
          if (dx*dx + dy*dy <= r*r) {
            const i = getIndex(x, y, canvas.width);
            data[i] = Math.min(255, data[i] + 15);
            data[i+1] = Math.min(255, data[i+1] + 15);
            data[i+2] = Math.min(255, data[i+2] + 15);
          }
        }
      }
      ctx.putImageData(currentImageData, 0, 0);
    }

    function paintShower(cx, cy) {
      if (!currentImageData || !originalImageData) return;
      const r = 15;
      const data = currentImageData.data;
      const orig = originalImageData.data;
      let healed = false;
      for (let y = Math.max(0, cy - r); y < Math.min(canvas.height, cy + r); y++) {
        for (let x = Math.max(0, cx - r); x < Math.min(canvas.width, cx + r); x++) {
          const dx = x - cx, dy = y - cy;
          if (dx*dx + dy*dy <= r*r) {
            const i = getIndex(x, y, canvas.width);
            data[i] = approach(data[i], orig[i], 15);
            data[i+1] = approach(data[i+1], orig[i+1], 15);
            data[i+2] = approach(data[i+2], orig[i+2], 15);
            healed = true;
          }
        }
      }
      ctx.putImageData(currentImageData, 0, 0);
      if (healed) {
        stats.health = Math.min(100, stats.health + 0.5);
        updateBars();
      }
    }

    function approach(current, target, step) {
      return current < target
        ? Math.min(current + step, target)
        : Math.max(current - step, target);
    }

    const kitchenFood = ["ðŸž", "ðŸ¥ž", "ðŸ§‡", "ðŸ–", "ðŸ—", "ðŸ•"];
    const kitchenBad = ["ðŸª¨", "âŒ›", "ðŸ‘“", "ðŸ•¶ï¸", "ðŸ¥½", "ðŸ§¤"];

    function generateKitchenItems() {
      const container = document.getElementById('kitchen-items');
      container.innerHTML = '';
      const pickRandom = (arr, count) => [...arr].sort(() => 0.5 - Math.random()).slice(0, count);

      pickRandom(kitchenFood, 3).forEach(char => {
        const el = document.createElement('div');
        el.textContent = char;
        el.className = 'kitchen-item';
        el.dataset.type = 'food';
        el.draggable = true;
        el.addEventListener('dragstart', e => kitchenDragging = e.target);
        container.appendChild(el);
      });

      pickRandom(kitchenBad, 2).forEach(char => {
        const el = document.createElement('div');
        el.textContent = char;
        el.className = 'kitchen-item';
        el.dataset.type = 'bad';
        el.draggable = true;
        el.addEventListener('dragstart', e => kitchenDragging = e.target);
        container.appendChild(el);
      });
    }

    let kitchenDragging = null;

    canvas.addEventListener('drop', e => {
      e.preventDefault();
      if (!kitchenDragging) return;
      const type = kitchenDragging.dataset.type;
      stats.hunger += type === 'food' ? 15 : -15;
      stats.hunger = Math.max(0, Math.min(100, stats.hunger));
      updateBars();
      generateKitchenItems();
      kitchenDragging = null;
    });

    canvas.addEventListener('dragover', e => e.preventDefault());

    // Decrease stats over time
    setInterval(() => {
      stats.hunger = Math.max(0, stats.hunger - 0.1);
      stats.health = Math.max(0, stats.health - 0.05);
      stats.fun = Math.max(0, stats.fun - 0.05);
      updateBars();
    }, 1000);

    showRoom('shower');
  </script>
</body>
</html>
